(()=>{"use strict";class t{constructor(){this._items={},this._page=0,this._totalPages=1,this._dataHost="http://localhost:40000"}clear(){this._items={}}render(){}}class e{constructor(t,e,s,i){this._CartInstance=t,this._productId=e,this._productName=s,this._quantity=1,this._price=i,this._amount=0,this._onChange()}_onChange(){this._amount=this._quantity*this._price,this._CartInstance.calcTotals()}render(t){const e=document.createElement("div");e.setAttribute("class","cart-item"),e.innerHTML=`${this._productName} : ${this._price} x ${this._quantity}`,t.appendChild(e)}}class s{constructor(t,{id:e,name:s,price:i,img:n}){this._ProductListInstance=t,this._id=e,this._name=s,this._price=i,this._img=n}id(){return this._id}price(){return this._price}name(){return this._name}render(t){const e=document.createElement("div");e.setAttribute("class","product-item"),t.appendChild(e);const s=document.createElement("img");s.setAttribute("src",this._img),s.setAttribute("class","product-img-top"),e.appendChild(s);const i=document.createElement("p");i.setAttribute("class","product-title"),i.innerHTML=this._name,e.appendChild(i);const n=document.createElement("p");n.setAttribute("class","product-text"),n.innerHTML=`Цена: ${this._price}`,e.appendChild(n);const a=document.createElement("button");a.setAttribute("class","btn-primary"),a.innerHTML="Добавить в корзину",e.appendChild(a),a.addEventListener("click",(()=>{this._ProductListInstance.addItemToCart(this)}))}}const i=new class extends t{constructor(){super(),this._initTotals()}addItem(t){const s=t.id();let i=this._items[s];null==i?(i=new e(this,s,t.name(),t.price()),this._items[s]=i):(i._quantity+=1,i._onChange()),this.calcTotals(),this.render()}removeItem(t){}_initTotals(){this._lineCount=0,this._quantity=0,this._amount=0}calcTotals(){this._initTotals();for(let[t,e]of Object.entries(this._items))this._lineCount+=1,this._amount+=e._amount,this._quantity+=e._quantity}totals(){return{lineCount:this._lineCount,quantity:this._quantity,amount:this._amount}}_fetchData(){}save(){}render(){const t=document.querySelector(".cart-list");if(t.innerHTML="",this._items){const e=document.createElement("h4");e.innerHTML="Ваша корзина",t.appendChild(e);for(let[e,s]of Object.entries(this._items))s.render(t);const s=document.createElement("h4");s.innerHTML=`Всего позиций ${this.totals().lineCount} на сумму ${this.totals().amount}`,t.appendChild(s)}}},n=new class extends t{constructor(t){super(),this._CartInstance=t,this._checkoutPage(1)}_checkoutPage(t){t<=this._totalPages&&t>0?this._fetchData(t).then(this._parseData.bind(this)).then(this.render.bind(this)).catch((t=>{console.log(t)})):console.log(`Cant go to page ${t}: total pages ${this._totalPages}.`)}_parseData(t){this._totalPages=t.totalPages,this._page=t.page,t._embedded.forEach((t=>this._items[t.id]=new s(this,t)))}_json(t){return t.json()}_fetchData(t){return fetch(`${this._dataHost}/api/products/page${t}.json`,{method:"GET",headers:{Accept:"application/json;charset=utf-8"}}).then(this._json)}addItemToCart(t){this._CartInstance.addItem(t)}render(){const t=document.querySelector(".product-list-btns");if(null==document.getElementById("showmore")){const e=document.createElement("button");e.id="showmore",e.innerText="Показать еще",t.appendChild(e),e.addEventListener("click",(()=>{this._checkoutPage(this._page+1)}))}const e=document.querySelector(".product-list");e.innerHTML="";for(let[t,s]of Object.entries(this._items))s.render(e)}}(i);console.log(n)})();